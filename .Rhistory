filter(!is.na(osm_id))
complete_temp <- access_raw %>%
left_join(
amenity_preference,
by = "amenity"
) %>%
left_join(
mode_preference,
by = "mode"
) %>%
group_by(id,mode,amenity) %>%
arrange(time) %>%
mutate(
amenity_rank = row_number() - 1
) %>%
ungroup()
amenity_preference <- data.frame(
amenity = c(
"park",
"convenience",
"restaurant",
"supermarket",
"library"
),
amenity_value = c(
0.8,
0.6,
0.25,
1,
0.7
),
amenity_quantity = c(
2,
5,
30,
1,
1
)
) %>%
mutate(
amenity_decay = -log(0.5)/(amenity_quantity)
)
mode_preference <- data.frame(
mode = c(
"walking",
"biking",
"driving"
),
mode_value = c(
1,
0.7,
0.5
),
mode_reasonable = c(
15,
10,
20
)
) %>%
mutate(
mode_decay = -log(0.5)/mode_reasonable
)
complete_temp <- access_raw %>%
left_join(
amenity_preference,
by = "amenity"
) %>%
left_join(
mode_preference,
by = "mode"
) %>%
group_by(id,mode,amenity) %>%
arrange(time) %>%
mutate(
amenity_rank = row_number() - 1
) %>%
ungroup()
mode_preference <- data.frame(
mode = c(
"walking",
"biking",
"driving"
),
mode_value = c(
1,
0.7,
0.5
),
mode_reasonable = c(
15,
10,
20
)
) %>%
mutate(
mode_decay = -log(0.5)/mode_reasonable
)
complete_temp <- access_raw %>%
left_join(
amenity_preference,
by = "amenity"
) %>%
left_join(
mode_preference,
by = "mode"
) %>%
group_by(id,mode,amenity) %>%
arrange(time) %>%
mutate(
amenity_rank = row_number() - 1
) %>%
ungroup()
mode_preference <- data.frame(
mode = c(
"walking",
"biking",
"driving"
),
mode_value = c(
1,
0.7,
0.5
),
mode_reasonable = c(
15,
10,
20
)
) %>%
mutate(
mode_decay = -log(0.5)/mode_reasonable
)
amenity_preference <- data.frame(
amenity = c(
"park",
"convenience",
"restaurant",
"supermarket",
"library"
),
amenity_value = c(
0.8,
0.6,
0.25,
1,
0.7
),
amenity_quantity = c(
2,
5,
30,
1,
1
)
) %>%
mutate(
amenity_decay = -log(0.5)/(amenity_quantity)
)
mode_preference <- data.frame(
mode = c(
"walking",
"biking",
"driving"
),
mode_value = c(
1,
0.7,
0.5
),
mode_reasonable = c(
15,
10,
20
)
) %>%
mutate(
mode_decay = -log(0.5)/mode_reasonable
)
complete_temp <- access_raw %>%
left_join(
amenity_preference,
by = "amenity"
) %>%
left_join(
mode_preference,
by = "mode"
) %>%
group_by(id,mode,amenity) %>%
arrange(time) %>%
mutate(
amenity_rank = row_number() - 1
) %>%
ungroup()
View(access_raw)
View(amenity_preference)
complete_temp <- access_raw %>%
left_join(
amenity_preference,
by = "amenity"
) %>%
left_join(
mode_preference,
by = "mode"
) %>%
group_by(id,mode,amenity) %>%
arrange(time) %>%
mutate(
amenity_rank = row_number() - 1
) %>%
ungroup()
complete_temp <- access_raw %>%
left_join(
amenity_preference,
by = "amenity"
)
View(complete_temp)
View(mode_preference)
View(access_raw)
smc_pois_filter <- smc_pois %>%
filter(amenity %in% c(
"sports centre"
#"park",
#"convenience",
#"restaurant",
#"supermarket",
#"library"
))
mapview(smc_pois_filter, zcol = "amenity")
smc_pois_filter <- smc_pois %>%
filter(amenity %in% c(
"sports centre"
#"park",
#"convenience",
#"restaurant",
#"supermarket",
#"library"
))
mapview(smc_pois_filter, zcol = "amenity")
smc_pois_filter <- smc_pois %>%
filter(amenity %in% c(
"sports center"
#"park",
#"convenience",
#"restaurant",
#"supermarket",
#"library"
))
mapview(smc_pois_filter, zcol = "amenity")
smc_pois_filter <- smc_pois %>%
filter(amenity %in% c(
"sports centre"
#"park",
#"convenience",
#"restaurant",
#"supermarket",
#"library"
))
smc_pois_filter <- smc_pois %>%
filter(amenity %in% c(
"sports_centre"
#"park",
#"convenience",
#"restaurant",
#"supermarket",
#"library"
))
mapview(smc_pois_filter, zcol = "amenity")
View(smc_pois_filter)
View(smc_boundary)
setwd("~/Documents/GitHub/vivekvajipey.github.io")
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(leaflet)
library(mapboxapi)
mb_access_token("pk.eyJ1IjoidnZhamlwZXkiLCJhIjoiY2t5dWxpN2xuMW9yYjJubnVrY2trdGF4ZCJ9.v4iJv_62J6JLt2rHxP-QTQ", install = T, overwrite = TRUE)
pois_filter <- pois %>%
rename(amenity = fclass) %>%
filter(amenity %in% c(
"supermarket",
"convenience",
"restaurant",
"school",
"park",
"hospital",
"doctors",
"dentist",
"library",
"sports_centre",
"swimming_pool",
"pharmacy"
))
mapview(pois_filter, zcol = "amenity")
pois_filter <- pois %>%
rename(amenity = fclass) %>%
filter(amenity %in% c(
"supermarket",
"convenience",
"restaurant",
"school",
"park",
"hospital",
"doctors",
"dentist",
"library",
"sports_centre",
"swimming_pool",
"pharmacy"
))
mapview(pois_filter, zcol = "amenity")
cc_cbgs <- block_groups("CA","Contra Costa")
ant_boundary <- places("CA") %>%
filter(NAME == "Antioch")
ant_cbgs <- cc_cbgs %>%
st_centroid() %>%
.[nfo_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_cbgs %>% select(GEOID)) %>%
st_as_sf()
mapview(ant_cbgs)
ant_cbgs <- cc_cbgs %>%
st_centroid() %>%
.[nfo_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_cbgs %>% select(GEOID)) %>%
st_as_sf()
View(cc_cbgs)
mapview(ant_cbgs)
ant_cbgs <- cc_cbgs %>%
st_centroid() %>%
.[ant_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_cbgs %>% select(GEOID)) %>%
st_as_sf()
mapview(ant_cbgs)
View(ant_cbgs)
View(cc_cbgs)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(leaflet)
library(mapboxapi)
mb_access_token("pk.eyJ1IjoidnZhamlwZXkiLCJhIjoiY2t5dWxpN2xuMW9yYjJubnVrY2trdGF4ZCJ9.v4iJv_62J6JLt2rHxP-QTQ", install = T, overwrite = TRUE)
```{r}
cc_blocks <- blocks("CA","Contra Costa")
View(cc_blocks)
ant_blocks <- cc_blocks %>%
st_centroid() %>%
.[nfo_boundary, ] %>%
st_drop_geometry() %>%
left_join(smc_cbgs %>% select(GEOID)) %>%
st_as_sf()
ant_blocks <- cc_blocks %>%
st_centroid() %>%
.[ant_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_cbgs %>% select(GEOID)) %>%
st_as_sf()
View(cc_blocks)
ant_blocks <- cc_blocks %>%
st_centroid() %>%
.[ant_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_blocks %>% select(GEOID)) %>%
st_as_sf()
ant_blocks <- cc_blocks %>%
st_centroid() %>%
.[ant_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_blocks %>% select(GEOID10)) %>%
st_as_sf()
mapview(ant_blocks)
mapview(san_ram_blocks)
san_ram_boundary <- places("CA") %>%
filter(NAME == "San Ramon")
san_ram_blocks <- cc_blocks %>%
st_centroid() %>%
.[san_ram_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_blocks %>% select(GEOID10)) %>%
st_as_sf()
san_ram_blocks <- cc_blocks %>%
st_centroid() %>%
.[san_ram_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_blocks %>% select(GEOID10)) %>%
st_as_sf()
mapview(san_ram_blocks)
saveRDS(san_ram_blocks, "san_ram_blocks.rds")
san_ram_blocks <- readRDS("san_ram_blocks.rds")
isochrones <- c("walking","driving") %>%
map_dfr(function(x){
mb_isochrone(
san_ram_blocks,
profile = x,
time = c(5,10,15)
) %>%
mutate(mode = x)
})
isochrones <- c("walking","driving") %>%
map_dfr(function(x){
mb_isochrone(
san_ram_blocks,
profile = x,
time = c(5,10,15)
) %>%
mutate(mode = x)
})
saveRDS(isochrones, "san_ram_isochrones.rds")
isochrones <- readRDS("san_ram_isochrones.rds")
View(isochrones)
View(isochrone)
access_raw <- isochrones %>%
st_make_valid() %>%
st_join(pois_filter) %>%
filter(!is.na(osm_id)) %>%
st_drop_geometry()
View(access_raw)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(tigris)
library(censusapi)
library(mapview)
library(leaflet)
library(mapboxapi)
mb_access_token("pk.eyJ1IjoidnZhamlwZXkiLCJhIjoiY2t5dWxpN2xuMW9yYjJubnVrY2trdGF4ZCJ9.v4iJv_62J6JLt2rHxP-QTQ", install = T, overwrite = TRUE)
path <- "/Volumes/GoogleDrive/Shared drives/SFBI/Data Library/NHTS/nhts17-caltrans-tsdc-download/"
pois <- st_read("/Volumes/GoogleDrive/Shared drives/SFBI/Data Library/OSM/gis_osm_pois_a_free_1.shp")
pois_summary <- pois %>%
st_drop_geometry() %>%
group_by(fclass) %>%
count() %>%
arrange(desc(n))
pois_summary
cc_boundary <- counties("CA") %>%
filter(NAME == "Contra Costa") %>%
st_transform(st_crs(pois))
# will take longer but handles larger POIs better
cc_pois <- pois %>%
.[cc_boundary,] %>%
rename(amenity = fclass)
mapview(cc_pois, zcol = "amenity")
pois_filter <- pois %>%
rename(amenity = fclass) %>%
filter(amenity %in% c(
"supermarket",
"convenience",
"restaurant",
"school",
"park",
"hospital",
"doctors",
"dentist",
"library",
"sports_centre",
"swimming_pool",
"pharmacy"
))
mapview(pois_filter, zcol = "amenity")
saveRDS(pois_filter, "pois_filter.rds")
pois_filter <- readRDS("pois_filter.rds")
cc_blocks <- blocks("CA","Contra Costa")
ant_boundary <- places("CA") %>%
filter(NAME == "Antioch")
ant_blocks <- cc_blocks %>%
st_centroid() %>%
.[ant_boundary, ] %>%
st_drop_geometry() %>%
left_join(cc_blocks %>% select(GEOID10)) %>%
st_as_sf()
mapview(ant_blocks)
saveRDS(ant_blocks, "ant_blocks.rds")
ant_blocks <- readRDS("ant_blocks.rds")
isochrones <- c("walking","driving") %>%
map_dfr(function(x){
mb_isochrone(
ant_blocks,
profile = x,
time = c(5,10,15)
) %>%
mutate(mode = x)
})
saveRDS(isochrones, "ant_isochrones.rds")
isochrones <- readRDS("ant_isochrones.rds")
access_raw <- isochrones %>%
st_make_valid() %>%
st_join(pois_filter) %>%
filter(!is.na(osm_id)) %>%
st_drop_geometry()
ant_isochrones <- c("walking","driving") %>%
map_dfr(function(x){
mb_isochrone(
ant_blocks,
profile = x,
time = c(5,10,15)
) %>%
mutate(mode = x)
})
saveRDS(ant_isochrones, "ant_isochrones.rds")
ant_isochrones <- readRDS("ant_isochrones.rds")
ant_access_raw <- ant_isochrones %>%
st_make_valid() %>%
st_join(pois_filter) %>%
filter(!is.na(osm_id)) %>%
st_drop_geometry()
